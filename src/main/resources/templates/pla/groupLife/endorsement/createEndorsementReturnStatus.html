<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head th:include="fragments/common :: headTag">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <!--/*-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
    <link href="https://www.fuelcdn.com/fuelux/3.6.3/css/fuelux.min.css" rel="stylesheet">
    <link href="../../../../static/css/common.css" rel="stylesheet">
    <script data-main="../../../../static/js/requireConfig"
            src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.16/require.min.js"></script>
    <!--*/-->
</head>
<body class="fuelux ng-cloak" style="overflow-x: hidden;">
<div th:include="fragments/common :: bodyHeader" th:remove="tag"/>
<script th:inline="javascript">
    /*<![CDATA[*/
    var isNumeric = function (evt) {

        var charCode = (evt.which) ? evt.which : evt.keyCode;
        if (charCode == 13) {
            evt.preventDefault();
        }

        if (charCode > 31 && charCode != 8 && charCode != 0 && charCode != 46 && (charCode < 48 || charCode > 57 ))
            return false;
        return true;

    }
    var isAlpha = function (evt) {

        var charCode = (evt.which) ? evt.which : evt.keyCode;
        if (charCode == 13) {
            evt.preventDefault();
        }

        if ((charCode > 64 && charCode < 91) || (charCode > 96 && charCode < 123)) {
            return true;
        } else if (charCode > 31 && charCode != 8 && charCode != 0) {
            return false;
        }


    }

    /*]]>*/
</script>
<script>
    var isEnterKey = function (event) {
        var charCode = (event.which) ? event.which : event.keyCode;

        if (charCode == 13) {
            event.preventDefault();
        }
    }


    requirejs(['main', 'angular-file-upload'], function () {
        require(['/pla/js/grouplife/endorsement/createEndorsement.js?t=9'], function () {
            angular.element(document).ready(function () {
                angular.bootstrap(document, ['createEndorsement']);
            });
        });

    });
</script>
<script type="text/ng-template" id="createEndorsementTpl.html">
    <p class="container lead">
    <ol class="container breadcrumb">
        <li>Endorsement</li>
        <li>Group Life</li>
    </ol>
    </p>

    <nth-alert></nth-alert>
    <form name="policyForm" novalidate="true" class="container css-form ng-cloak" method="post" enctype="multipart/form-data">
        <div class="wizard fueluxWizard"  selected-item="selectedItem">
            <ul class="steps" style="margin-left: 0">
                <li data-step="1"><span class="badge badge-info">1</span>Comments<span class="chevron"></span>
                </li>
                <li data-step="2"><span class="badge badge-info">2</span>Basic Details<span class="chevron"></span></li>
                <li data-step="3"><span class="badge">3</span>PolicyHolder Details<span class="chevron"></span></li>
                <li data-step="4"><span class="badge">4</span>Documents<span class="chevron"></span></li>
            </ul>


            <div class="actions">
                <span style="font-weight: bold;color: #999">Endorsement Request Number: <span
                        style="font-size: 13px;color: #3a87ad;">{{endorsementNumber}}</span></span>
                <button type="button" class="btn btn-default btn-prev" disabled="disabled"><span
                        class="glyphicon glyphicon-arrow-left"></span>Prev
                </button>
                <button type="button" class="btn btn-default btn-next" ng-disabled="!stepsSaved[selectedItem]">Next<span
                        class="glyphicon glyphicon-arrow-right"></span></button>
                <!-- -->
            </div>
            <div class="step-content ng-cloak">
                <div class="step-pane active" data-step="1">
                    <div style="height:300px;overflow-y:scroll;border:1px solid grey;margin-top:10px;margin-bottom: 10px;">
                        <table class="table table-striped table-bordered" style="margin-top:5px;">
                            <thead>
                            <tr>
                                <th>UserName</th>
                                <th>Date And Time</th>
                                <th>Comments</th>
                            </tr>
                            </thead>
                            <tbody>

                            <tr ng-repeat="approvalComment in approvalCommentList">
                                <td>{{approvalComment.modifiedBy}}</td>
                                <td>{{approvalComment.id.time | date:'dd/MM/yyyy h:mm a'}}</td>
                                <td>{{approvalComment.comment}}</td>


                            </tr>
                            </tbody>
                        </table>
                    </div>


                    <div class="row">
                        <div class="col-sm-6">
                            <button type="button" class="btn btn-default btn-sm" ng-click="back()">Cancel</button>

                        </div>
                    </div>
                </div>

                <div class="step-pane" data-step="2">
                    <ng-form name="step2">
                        <div class="bs-callout  bs-callout-info" style="margin-bottom: 7px">

                            <div class="row ng-cloak">
                                <div class="col-lg-6">
                                    <div class="form-group required">
                                        <label class="control-label">PolicyHolder Name</label>
                                        <input type="text" class="form-control input-sm" name="policyHolderName"
                                               ng-if="policyDetails.basicDetails.policyHolderName"
                                               ng-model="policyDetails.basicDetails.policyHolderName"
                                               ng-required="true" ng-disabled="true"/>
                                    </div>
                                </div>

                                <div class="col-lg-6">
                                    <div class="form-group required">
                                        <label class="control-label">Policy Inception Date</label>
                                        <input type="text" class="form-control input-sm" name="inceptionDate"
                                               ng-model="policyDetails.basicDetails.inceptionDate"
                                               ng-required="true" ng-disabled="true"/>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="form-group required">
                                        <label class="control-label">Policy Expiry Date</label>
                                        <input type="text" class="form-control input-sm" ng-readonly="true"
                                               ng-required="true" name="expiryDate"
                                               ng-model="policyDetails.basicDetails.expiryDate"/>
                                    </div>

                                </div>
                                <div class="col-lg-6">
                                    <div class="form-group required">
                                        <label class="control-label">Policy Issuance Date</label>
                                        <input type="text" class="form-control input-sm" name="issuanceDate"
                                               ng-model="policyDetails.basicDetails.inceptionDate"
                                               ng-required="true" ng-disabled="true"/>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="form-group ">
                                        <label class="control-label">Scheme Name</label>
                                        <input type="text" class="form-control input-sm" name="schemeName"
                                               ng-disabled="true"/>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label class="control-label">Endorsement Effective Date</label>
                                        <input type="text" class="form-control input-sm" name="effectiveDate"
                                                ng-model="policyDetails.basicDetails.effectiveDate"
                                               ng-disabled="true"/>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="form-group required">
                                        <label class="control-label">Endorsement Type</label>
                                        <input type="text" class="form-control input-sm" name="endorsementType"
                                               ng-required="true" ng-model="policyDetails.basicDetails.endorsementType"
                                               ng-disabled="true"/>
                                    </div>
                                </div>


                            </div>
                        </div>
                    </ng-form>
                    <div class="row">
                        <div class="col-sm-6">
                            <button type="button" class="btn btn-default btn-sm" ng-click="back()">Cancel</button>
                        </div>

                    </div>
                </div>
                <div class="step-pane" data-step="3">
                    <ng-form name="step3">
                        <accordion close-others="true">
                            <accordion-group is-open="accordionStatus.proposer">
                                <accordion-heading>
                                    Proposer Details <i class="pull-right glyphicon"
                                                        ng-class="{'glyphicon-chevron-down': accordionStatus.proposer, 'glyphicon-chevron-right': !accordionStatus.proposer}"></i>
                                </accordion-heading>
                                <div class="col-lg-6">
                                    <div class="form-group required">
                                        <label class="control-label">Proposer Name</label>
                                        <input type="text" class="form-control input-sm"
                                               ng-disabled="!isEnablePolicyHolderMode" name="proposerName"
                                               onkeypress="return isAlpha(event)" ng-required="true"
                                               ng-model="policyDetails.proposer.proposerName"/>
                                    </div>
                                    <div class="form-group required">
                                        <label class="control-label">Address Line 1</label>
                                        <input type="text" class="form-control input-sm"
                                               ng-disabled="!isEnableContactMode" ng-required="true"
                                               onkeypress="return isNumeric(event)" name="addressLine1"
                                               ng-maxlength="100" ng-model="policyDetails.proposer.addressLine1"/>
                                    </div>
                                    <div class="form-group">
                                        <label>Postal Code</label>
                                        <input type="text" class="form-control input-sm" name="postalCode"
                                               ng-disabled="!isEnableContactMode" onkeypress="return isNumeric(event)"
                                               ng-model="policyDetails.proposer.postalCode"/>
                                    </div>
                                    <div class="form-group required">
                                        <label class="control-label">Town</label>
                                        <select class="form-control input-sm" ng-required="true" name="town"
                                                ng-disabled="!isEnableContactMode"
                                                ng-model="policyDetails.proposer.town"
                                                ng-options="city.geoId as city.geoName for city in cities">
                                            <option value="">-- Select Town --</option>
                                        </select>
                                    </div>
                                    <!-- <div class="form-group required">
                                         <label class="control-label">Work Phone</label>
                                         <input type="text" class="form-control input-sm" ng-required="true" maxlength="13" ng-pattern="numberPattern" ng-model="policyDetails.proposer.contactPersonWorkPhoneNumber"/>
                                     </div>-->
                                </div>
                                <div class="col-lg-6">
                                    <div class="form-group required">
                                        <label class="control-label">Proposer Code</label>
                                        <input type="text" class="form-control input-sm" ng-required="true"
                                               ng-disabled="true" onkeypress="return isNumeric(event)"
                                               name="proposerCode" ng-model="policyDetails.proposer.proposerCode"/>
                                    </div>
                                    <div class="form-group">
                                        <label>Address Line 2</label>
                                        <input type="text" class="form-control input-sm" maxlength="100"
                                               ng-disabled="!isEnableContactMode" onkeypress="return isNumeric(event)"
                                               ng-model="policyDetails.proposer.addressLine2"/>
                                    </div>
                                    <div class="form-group required">
                                        <label class="control-label">Province</label>
                                        <select class="form-control input-sm" ng-required="true" name="province"
                                                ng-disabled="!isEnableContactMode"
                                                ng-model="policyDetails.proposer.province"
                                                ng-options="province.provinceId  as province.provinceName for province in provinces"
                                                ng-change="getCurrentVal(policyDetails.proposer.province)">
                                        </select>
                                    </div>
                                    <!--<div class="form-group">
                                        <label >Email</label>
                                        <input type="email" class="form-control input-sm" ng-required="true" ng-keydown="openNewTab($event)"/>
                                    </div>-->
                                </div>
                            </accordion-group>
                            <accordion-group is-open="accordionStatus.contact">
                                <accordion-heading>
                                    Contact Details <i class="pull-right glyphicon"
                                                       ng-class="{'glyphicon-chevron-down': accordionStatus.contact, 'glyphicon-chevron-right': !accordionStatus.contact}"></i>
                                </accordion-heading>
                                <div class="col-lg-6" disable-all-fields="!isEnableContactMode">
                                    <div class="form-group required">
                                        <label class="control-label">Contact Person Details</label>
                                        <input type="text" class="form-control input-sm" name="contactPersonDetails"
                                               onkeypress="return isAlpha(event)" maxlength="100" ng-required="true"
                                               ng-model="policyDetails.proposer.contactPersonName"/>
                                    </div>
                                    <div class="form-group required">
                                        <label class="control-label">Mobile Number</label>
                                        <input type="text" class="form-control input-sm" maxlength="10" minlength="10"
                                               name="mobileNumber" onkeypress="return isNumeric(event)"
                                               ng-required="true" ng-pattern="numberPattern"
                                               ng-model="policyDetails.proposer.contactPersonMobileNumber"/>

                                        <div ng-show="step3.mobileNumber.$invalid &amp;&amp; step3.mobileNumber.$dirty">
                                            <small class="error"
                                                   ng-show="!step3.mobileNumber.$error.pattern &amp;&amp; step3.mobileNumber.$error.minlength">
                                                Please enter a valid mobile number.
                                            </small>
                                            <small class="error" ng-show="step3.mobileNumber.$error.pattern">
                                                Only numbers are allowed.
                                            </small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6" disable-all-fields="!isEnableContactMode">
                                    <div class="form-group">
                                        <label class="control-label">Email</label>
                                        <input type="email" class="form-control input-sm" name="email"
                                               ng-model="policyDetails.proposer.contactPersonEmail"/>

                                        <div ng-show="step3.email.$invalid &amp;&amp; step3.email.$dirty">
                                            <small class="error" ng-show="step3.email.$error.email">
                                                Please enter a valid emailId.
                                            </small>
                                        </div>
                                    </div>
                                    <div class="form-group required">
                                        <label class="control-label">Work Phone</label>
                                        <input type="text" class="form-control input-sm" maxlength="13" minlength="13"
                                               name="workPhone" onkeypress="return isNumeric(event)" ng-required="true"
                                               ng-pattern="numberPattern"
                                               ng-model="policyDetails.proposer.contactPersonWorkPhoneNumber"/>

                                        <div ng-show="step3.workPhone.$invalid &amp;&amp; step3.workPhone.$dirty">
                                            <small class="error"
                                                   ng-show="!step3.workPhone.$error.pattern &amp;&amp; step3.workPhone.$error.minlength">
                                                Please enter a valid mobile number.
                                            </small>
                                            <small class="error" ng-show="step3.workPhone.$error.pattern">
                                                Only numbers are allowed.
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </accordion-group>
                        </accordion>
                    </ng-form>
                    <div class="row">
                        <div class="col-sm-6">
                            <button type="button" class="btn btn-default btn-sm" ng-click="back()">Cancel</button>
                        </div>
                        <div class="col-sm-6">
                            <button type="button" class="btn btn-default btn-sm" style="float: right"
                                    ng-click="saveProposerDetails()" ng-disabled="(step3.$invalid)" ng-if="isEnable">
                                Save
                            </button>
                        </div>
                    </div>
                </div>
                <div class="step-pane" data-step="4">
                    <ng-form name="step4" >
                        <accordion close-others="true">
                            <accordion-group is-open="accordionStatusDocuments.documents">
                                <accordion-heading>
                                    Mandatory Documents <i class="pull-right glyphicon"
                                                           ng-class="{'glyphicon-chevron-down': accordionStatusDocuments.documents,
                                                            'glyphicon-chevron-right': !accordionStatusDocuments.documents}"></i>
                                </accordion-heading>
                                <div class="bs-callout  bs-callout-info" style="overflow:auto;height:240px;padding-left:1px;"
                                        >

                                    <div class="form-group " ng-repeat="document in documentList">
                                        <label class="col-sm-5 control-label">{{document.documentName}}</label>

                                        <div class="input-group">
                                            <a href="/pla/grouplife/endorsement/downloadmandatorydocument/{{document.gridFsDocId}}"
                                               style="display:inline;float:right;" hg-show="!document.submitted">{{document.fileName | limitTo: 50}}</a>

                                            <button class="btn btn-default"
                                                    style="display:inline;float:right;margin-right:5px;"
                                                    ng-file-select=""
                                                    ng-model="document.documentAttached" ng-disabled="isViewMode" >Browse
                                            </button>
                                            <input class="form-control input-sm" style="width:200px;"
                                                   value="{{document.documentAttached[0].name}}"
                                                   readonly="true"/>

                                        </div>

                                    </div>
                                    <div class="btn btn-default" style="display:inline;float:right;clear:both"
                                         ng-click="uploadDocumentFiles()" ng-hide="(documentList.length &lt;  1 || isViewMode)">Upload All</div>
                                </div>
                            </accordion-group>
                            <accordion-group is-open="accordionStatusDocuments.additionalDocuments">
                                <accordion-heading>
                                    Additional Documents <i class="pull-right glyphicon"
                                                            ng-class="{'glyphicon-chevron-down': accordionStatusDocuments.additionalDocuments, 'glyphicon-chevron-right': !accordionStatusDocuments.additionalDocuments}"></i>
                                </accordion-heading>
                                <div class="bs-callout  bs-callout-info" style="overflow:auto;height:250px;"
                                        >

                                    <div class="row">
                                        <button class="btn btn-default"
                                                style="display:inline;float:left;margin-right:5px;"
                                                ng-click="addAdditionalDocument()" ng-disabled="isViewMode">Add Document
                                        </button>
                                    </div>
                                    <br/><br/>

                                    <div class="row">
                                        <div ng-repeat="additionalDocument in additionalDocumentList">
                                            <div class="row">
                                                <div class="col-lg-3">
                                                    <div class="form-group">
                                                        <label class="control-label">Document Title</label>
                                                        <input type="text" class="form-control input-sm"
                                                               name="documentTitle" ng-disabled="isViewMode"
                                                               onkeypress="return isEnterKey(event)"
                                                               ng-model="additionalDocument.documentId"/>
                                                    </div>
                                                </div>
                                                <div class="col-lg-4" ng-hide="isViewMode" >
                                                    <div class="form-group">

                                                        <label class="control-label">Browse File</label>
                                                        <button class="btn btn-default"
                                                                style="display:inline;float:right;margin-top:20px;"
                                                                ng-file-select="callAdditionalDoc(additionalDocument.documentAttached)"
                                                                ng-model="additionalDocument.documentAttached"
                                                                ng-disabled="!additionalDocument.documentId">Browse
                                                        </button>
                                                        <input class="form-control input-sm" style="width:262px;"
                                                               value="{{additionalDocument.documentAttached[0].name}}"
                                                               readonly="true"/>
                                                    </div>

                                                </div>
                                                <div class="col-lg-5">
                                                    <button class="btn btn-default" style="margin-top:20px;"
                                                            ng-click="removeAdditionalDocument($index)"
                                                            ng-disabled="isViewMode">Remove
                                                    </button>
                                                    <a href="/pla/grouplife/endorsement/downloadmandatorydocument/{{additionalDocument.gridFsDocId}}"
                                                       style="display:inline;font-weight:bold;" title="{{additionalDocument.fileName}}"
                                                       hg-show="!additionalDocument.submitted">{{additionalDocument.fileName|
                                                        limitTo: 70}}</a>

                                                </div>

                                            </div>
                                        </div>

                                    </div>
                                    <button class="btn btn-default"
                                            style="display:inline;float:right;margin-right:5px;margin-top:20px;"
                                            ng-click="uploadAdditionalDocument()" ng-disabled="!checkDocumentAttached"
                                            ng-hide="(additionalDocumentList.length &lt;  1)">Upload
                                    </button>


                                </div>
                            </accordion-group>
                        </accordion>
                        <div class="row" ng-hide="isViewMode">

                            <div class="form-group col-md-11 required">
                                <label class="control-label">Comments</label>
                                <textarea  class="form-control input-sm " rows="4" cols="50"
                                           ng-required="true" name="comment" id="comment"
                                           ng-model="comment"/>

                            </div>


                        </div>

                    </ng-form>
                    <div class="row">
                        <div class="col-sm-6">

                            <button type="button" class="btn btn-default btn-sm" ng-click="back()">Cancel</button>
                        </div>
                        <div class="col-sm-6">
                            <button type="button" class="btn btn-default btn-sm" style="float: right"
                                    ng-click="submitComments(comment)" ng-disabled="isViewMode || !comment">Submit
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
    <form method="POST" action="searchendorsement" id="searchForm">
        <input type="hidden" id="searchFormEndorsement" name="policyId"/>
    </form>

    <style>

        .fuelux .checkbox-custom:before {
            font-family: "Glyphicons Halflings" !important;
            font-style: normal !important;
            font-weight: normal !important;
            font-variant: normal !important;
            text-transform: none !important;
            line-height: 1;
            speak: none;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            border: 1px solid #adadad;
            border-radius: 4px;
            color: #fff;
            content: " ";
            font-size: 12px;
            height: 18px;
            left: 0;
            padding: 1px 0 0 1px;
            position: absolute;
            top: 3px;
            width: 18px;
        }

        .btn {
            font-size: 12px;
        }
    </style>
</script>
<div class="ng-view container-fluid">

</div>


<div class="modal fade" id="agentModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger" style="display: block">
                <h3 class="modal-title">Alert</h3>
            </div>
            <div class="modal-body">
                <h4 class="text-danger">Agent is inactive. Please enter a valid Agent ID.</h4>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" data-dismiss="modal">OK</button>
            </div>
        </div>
    </div>
</div>
<footer class="footer" th:include="fragments/common :: footer">
</footer>
</body>
</html>
